<!DOCTYPE HTML>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="include :: head('菜单列表')"></head>
<body>
<div class="layui-card">
    <div class="layui-card-body">
        <div class="yadmin-body animated fadeIn">
            <script type="text/html" id="toolbar">
                <button type="button" class="layui-btn layui-btn-xs layui-btn-normal" lay-event="add">
                    <i class="layui-icon layui-icon-addition">新增</i>
                </button>
                <button type="button" class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">
                    <i class="layui-icon layui-icon-delete" title="删除">删除</i>
                </button>
            </script>
            <table class="layui-hide" id="table-list"></table>
            <script type="text/html" id="statusTpl">
                <input type="checkbox" value="{{d.userId}}" lay-skin="switch" lay-text="启用|禁用" lay-filter="status" {{ d.enabled=="1"?"checked":"" }}>
            </script>
            <script type="text/html" id="column-toolbar">
                <button type="button" class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit">
                    <i class="layui-icon layui-icon-edit" title="编辑">编辑</i>
                </button>
            </script>
        </div>
    </div>
</div>
<script>
layui.use(['tableTree'], function (tableTree) {
    layer.load(2);  //加载层
    var table = tableTree.render({
        id: 'menu',
        elem: '#table-list',
        url: '/admin/res/list',
        height: 'full-150',
        method: 'post',
        tree: {
            iconIndex: 2,
            isPidData: true,
            idName: 'id',//父ID
            pidName: 'parentId',//子ID
            openName: 'openFlag',// 是否默认展开的字段名
        },
        toolbar: '#toolbar',
        cols: [
            [
                {type: 'checkbox'},
                {field: 'id', title: '序号', minWidth: 30},
                {field: 'name', title: '名称', minWidth: 40},
                {field: 'code', title: '编码', minWidth: 40},
                {field: 'url', title: '请求地址', minWidth: 100},
                {field: 'sort', title: '排序', minWidth: 30},
                {field: 'levels', title: '层级', minWidth: 30},
                {
                    field: 'ismenu', title: '类型', minWidth: 30, templet: function (res) {
                        if (res.ismenu == "Y") {
                            return "目录";
                        }
                        return "菜单";
                    }
                },
                {field: 'enabled', title: '状态', align: 'center', templet: "#statusTpl", width: 100},
                {fixed: 'right', title: '操作', align: 'center', toolbar: '#column-toolbar'}
            ]
        ],
        parseData: function (res) {
            return {
                "code": res.code,
                "msg": res.msg,
                "data": res.data,
                "count": res.total
            };
        },
        //数据渲染完的回调
        done: function () {
            //关闭加载
            layer.closeAll('loading');
        }
    });
    
    tableTree.on('toolbar', function (obj) {
        if (obj.event === 'add') {
            editView("/admin/res/edit", "添加菜单");
        } else if (obj.event === 'del') {
            layer.confirm('真的删除行么?', function (index) {
                let selectData = table.checkStatus('menu');
                if (selectData.length > 0) {
                    let idsArray = [];
                    for (let i = 0; i < selectData.length; i++) {
                        idsArray.push(selectData[i].id);
                    }
                    let ids = idsArray.toString();
                    changeReq(ids, '/admin/res/del')
                    layer.close(index);
                }
            });
        }
    });
    
    tableTree.on('tool', function (obj) {
        let data = obj.data, event = obj.event;
        if (event === 'edit') {
            editView("/admin/res/edit?id=" + data.id, "编辑菜单");
        }
    });
});
</script>
</body>
</html>